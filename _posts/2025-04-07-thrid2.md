---
layout: single
title:  "주사위 문제 해결하기"
---
#웹 크롤링 #위키피디아 데이터 추출 #rvest활용

# 조선 관련 역사 드라마 웹 크롤링
- HTML 구조 활용
- rvest 활용
- 위키피디아에서 조선과 관련된 드라마 정보를 크롤링한다.

## 사용된 코드
- 표(테이블) 형태로 된 정보와 텍스트 형식으로 된 정보 크롤링

```r
# 패키지 로드
library(rvest)
library(httr)


# URL
url <- "https://ko.wikipedia.org/wiki/태조_(조선)"
page <- read_html(url)

# XPath로 테이블 tbody 선택
table_node <- page %>%
  html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[30]/table/tbody/tr/td[1]/table')

# HTML 테이블을 R 데이터프레임으로 변환
df <- table_node %>% html_table(fill = TRUE)

# 확인
print(df)

# CSV 파일로 저장
write.csv(df, file = "태조_조선_표1.csv", row.names = FALSE, fileEncoding = "UTF-8")


## 정조

# URL
url <- "https://ko.wikipedia.org/wiki/정조_(조선)"
page <- read_html(url)

# XPath로 원하는 div[2] 노드 선택
node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[66]/table/tbody/tr/td/div[2]')

# 텍스트 추출
text <- node %>% html_text(trim = TRUE)

# 데이터프레임으로 변환
df <- data.frame(내용 = text)

# CSV 파일로 저장
write.csv(df, file = "정조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 태종

# URL: 태종 (조선)
url <- "https://ko.wikipedia.org/wiki/태종_(조선)"
page <- read_html(url)

# XPath로 테이블 노드 선택
table_node <- page %>%
  html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[33]/table/tbody/tr/td[1]/table')

# HTML 테이블 → 데이터프레임
df <- table_node %>% html_table(fill = TRUE)

# CSV로 저장
write.csv(df, file = "태종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 세종

# URL: 세종 (조선)
url <- "https://ko.wikipedia.org/wiki/세종_(조선)"
page <- read_html(url)

# XPath로 테이블 선택
table_node <- page %>%
  html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[44]/table/tbody/tr/td[1]/table')

# HTML 테이블 → 데이터프레임
df <- table_node %>% html_table(fill = TRUE)

# CSV 저장
write.csv(df, file = "세종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 문종

# URL: 문종 (조선)
url <- "https://ko.wikipedia.org/wiki/문종_(조선)"
page <- read_html(url)

# XPath로 ul 태그 선택
ul_node <- page %>%
  html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[10]/table/tbody/tr/td[1]/ul')

# 각 li 항목 텍스트 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임으로 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "문종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 단종
# URL: 단종 (조선)
url <- "https://ko.wikipedia.org/wiki/단종_(조선)"
page <- read_html(url)

# XPath로 첫 번째 <ul> 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[1]')

# 각 <li> 항목 텍스트 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임으로 변환
df <- data.frame(항목 = items)

# CSV로 저장
write.csv(df, file = "단종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 세조

# URL 설정
url <- "https://ko.wikipedia.org/wiki/세조_(조선)"
page <- read_html(url)

# 결과를 저장할 리스트 초기화
result <- list()

# ul[2]부터 ul[13]까지 반복
for (i in 2:13) {
  xpath <- paste0('//*[@id="mw-content-text"]/div[1]/ul[', i, ']')
  
  ul_node <- page %>% html_node(xpath = xpath)
  
  # 해당 ul이 존재할 때만 처리
  if (!is.na(ul_node)) {
    items <- ul_node %>%
      html_elements("li") %>%
      html_text(trim = TRUE)
    
    # 리스트에 저장
    result[[paste0("ul", i)]] <- items
  }
}

# 리스트를 데이터프레임으로 변환
df <- data.frame(
  출처 = rep(names(result), times = sapply(result, length)),
  항목 = unlist(result),
  row.names = NULL
)

# CSV 저장
write.csv(df, file = "세조조_조선_상세정보.csv", row.names = FALSE, fileEncoding = "UTF-8")


## 예종

# URL: 예종 (조선)
url <- "https://ko.wikipedia.org/wiki/예종_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[1]')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임으로 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "예종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 성종

# URL: 성종 (조선)
url <- "https://ko.wikipedia.org/wiki/성종_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[13]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "성종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 연산군

# URL: 연산군 (조선)
url <- "https://ko.wikipedia.org/wiki/연산군"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[39]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "연산군_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 중종

# URL 설정
url <- "https://ko.wikipedia.org/wiki/중종_(조선)"
page <- read_html(url)

# 해당 XPath의 노드 선택
node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[22]')

# 그 안의 첫 번째 table 추출 (있을 경우)
table_node <- node %>% html_node("table")

# 테이블이 존재할 경우만 변환
if (!is.na(table_node)) {
  df <- table_node %>% html_table(fill = TRUE)
}
# CSV 저장
write.csv(df, file = "중종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")
  
## 인종

# URL: 인종 (조선)
url <- "https://ko.wikipedia.org/wiki/인종_(조선)"
page <- read_html(url)

# XPath로 <ul>[2] 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[2]')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "인종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")


## 명종

# URL: 명종 (조선)
url <- "https://ko.wikipedia.org/wiki/명종_(조선)"
page <- read_html(url)

# XPath로 <ul>[1] 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[1]')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "명종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")


## 선조

# URL: 선조 (조선)
url <- "https://ko.wikipedia.org/wiki/선조_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[50]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "선조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 광해군

# URL: 광해군 (조선)
url <- "https://ko.wikipedia.org/wiki/광해군"
page <- read_html(url)

# XPath로 <td> 노드 선택
td_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[31]/table/tbody/tr/td[1]')

# 텍스트 전체 추출
raw_text <- td_node %>% html_text(trim = TRUE)

# 줄 단위로 분할
items <- unlist(strsplit(raw_text, "\n"))

# 빈 항목 제거
items <- items[nzchar(items)]

# 데이터프레임으로 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "광해군_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 인조

# URL: 인조 (조선)
url <- "https://ko.wikipedia.org/wiki/인조_(조선)"
page <- read_html(url)

# XPath로 <ul>[1] 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[1]')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "인조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 효종

# URL: 효종 (조선)
url <- "https://ko.wikipedia.org/wiki/효종_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/center/table/tbody/tr/td/div[7]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "효종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 현종

# URL: 현종 (조선)
url <- "https://ko.wikipedia.org/wiki/현종_(조선)"
page <- read_html(url)

# XPath로 <ul>[1] 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/ul[1]')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "현종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 숙종
# URL: 숙종 (조선)
url <- "https://ko.wikipedia.org/wiki/숙종_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[21]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "숙종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 경종
# URL: 경종 (조선)
url <- "https://ko.wikipedia.org/wiki/경종_(조선)"
page <- read_html(url)

# XPath로 <div>[23] 노드 선택
div_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[23]')

# 텍스트 전체 추출
raw_text <- div_node %>% html_text(trim = TRUE)

# 줄 단위로 나누기
items <- unlist(strsplit(raw_text, "\n"))

# 빈 줄 제거
items <- items[nzchar(items)]

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "경종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 영조
# URL: 영조 (조선)
url <- "https://ko.wikipedia.org/wiki/영조_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[32]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "영조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 정조
# URL: 정조 (조선)
url <- "https://ko.wikipedia.org/wiki/정조_(조선)"
page <- read_html(url)

# XPath로 <div>[66] 내부 div[2] 선택
div_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[66]/table/tbody/tr/td/div[2]')

# 텍스트 추출
raw_text <- div_node %>% html_text(trim = TRUE)

# 줄 단위 분할
items <- unlist(strsplit(raw_text, "\n"))
items <- items[nzchar(items)]  # 빈 줄 제거

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "정조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 순조

# URL: 순조 (조선)
url <- "https://ko.wikipedia.org/wiki/순조_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[26]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "순조_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

## 철종

# URL: 철종 (조선)
url <- "https://ko.wikipedia.org/wiki/철종_(조선)"
page <- read_html(url)

# XPath로 <ul> 노드 선택
ul_node <- page %>% html_node(xpath = '//*[@id="mw-content-text"]/div[1]/div[23]/table/tbody/tr/td[1]/ul')

# <li> 항목 추출
items <- ul_node %>%
  html_elements("li") %>%
  html_text(trim = TRUE)

# 데이터프레임 변환
df <- data.frame(항목 = items)

# CSV 저장
write.csv(df, file = "철종_조선_정보.csv", row.names = FALSE, fileEncoding = "UTF-8")

a <- read.csv("C:/Users/hun-0/Desktop/캡스톤디자인/문종_조선_정보.csv")
a
```

# 데이터 정제
- 결측치 제거
- 표 형식에서 추출한 데이터와 텍스트 형식에서 추출한 데이터의 형태가 다르므로 통일시켜준다.

## 사용된 코드
- 저장된 데이터 형식이 다른 왕 이름만 바꿔서 사용하면 된다.
```r
#방법1.
# CSV 파일 불러오기
data <- read.csv("C:/Users/hun-0/Desktop/캡스톤디자인/효조_조선_표1.csv", fileEncoding = "utf-8")

# 필요한 패키지 로드
library(stringr)

# 데이터 확인
head(data)

# 예: "항목"이라는 열에 정보가 들어 있다고 가정
# "항목" 열에서 제목, 방송국, 연도, 배우 정보 추출

data$드라마제목 <- str_replace_all(str_extract(data$항목, "《[^》]+》"), "《|》", "")
data$방영연도 <- as.numeric(str_extract(data$항목, "\\d{4}"))
data$방송국 <- str_replace_all(str_extract(data$항목, "\\(([^,]+),"), "\\(|,", "")
배우원문 <- str_extract(data$항목, "배우:[^\\)]+")
data$배우 <- str_replace(배우원문, "배우:", "")
# 결과 확인
head(data)

# 1. NA 값이 포함된 행 제거
data <- na.omit(data)

# 2. '항목' 열 삭제
data$항목 <- NULL  # 또는: data <- subset(data, select = -항목)

# 3. 같은 경로로 덮어쓰기 저장
write.csv(data, "C:/Users/hun-0/Desktop/캡스톤디자인/효종_조선_표1.csv", row.names = FALSE, fileEncoding = "utf-8")



#방법2.
# CSV 파일 불러오기
data <- read.csv("C:/Users/hun-0/Desktop/캡스톤디자인/철종_조선_정보.csv", fileEncoding = "utf-8")

# 필요한 패키지 로드
library(stringr)

# 데이터 확인
head(data)

# 예: "항목"이라는 열에 정보가 들어 있다고 가정
# "항목" 열에서 제목, 방송국, 연도, 배우 정보 추출

data$드라마제목 <- str_replace_all(str_extract(data$항목, "《[^》]+》"), "《|》", "")
data$방영연도 <- as.numeric(str_extract(data$항목, "\\d{4}"))
data$방송국 <- str_replace_all(str_extract(data$항목, "\\(([^,]+),"), "\\(|,", "")
배우원문 <- str_extract(data$항목, "배우:[^\\)]+")
data$배우 <- str_replace(배우원문, "배우:", "")


#################
data$방송국 <- str_extract(data$항목, "(?<=\\d{4}년\\s)[^\\s]+") 

######################

# 드라마 제목: 《...》 안에 있는 텍스트
data$드라마제목 <- str_replace_all(str_extract(data$항목, "《[^》]+》"), "《|》", "")

# 방영연도: 괄호 안 숫자
data$방영연도 <- str_extract(data$항목, "\\d{4}")

# 방송국: 괄호 안에서 , 다음에 오는 단어
data$방송국 <- str_extract(data$항목, "(?<=, )[^\\)]+")  # ',' 다음에 ')' 전까지

# 배우: `-` 다음부터 `[` 앞까지
data$배우 <- str_trim(str_extract(data$항목, "(?<=- ).+"))

#######################


# 드라마 제목: 우선 《...》 있으면 그걸 추출, 없으면 '년' 다음부터 ' - ' 전까지
has_brackets <- str_detect(data$항목, "《[^》]+》")
data$드라마제목 <- ifelse(
  has_brackets,
  str_replace_all(str_extract(data$항목, "《[^》]+》"), "《|》", ""),
  str_trim(str_extract(data$항목, "(?<=년\\s).+(?=\\s+-)"))
)

# 방영연도: 4자리 숫자
data$방영연도 <- as.numeric(str_extract(data$항목, "\\d{4}"))

# 방송국: 연도 뒤 단어
data$방송국 <- str_extract(data$항목, "(?<=\\d{4}년\\s)[^\\s]+")

# 배우: ' - ' 이후 문자열 추출
data$배우 <- str_trim(str_extract(data$항목, "(?<=- ).+"))

######
# 드라마제목: 《...》 사이
data$드라마제목 <- str_replace_all(str_extract(data$항목, "《[^》]+》"), "《|》", "")

# 방송국: 괄호 안에서 쉼표 앞
data$방송국 <- str_extract(data$항목, "(?<=\\()[^,]+")

# 방영연도: 4자리 숫자
data$방영연도 <- as.numeric(str_extract(data$항목, "\\d{4}"))

# 배우 추출: '배우' 기준으로 split 후 뒷부분 가져오기
배우부분 <- str_split_fixed(data$항목, "배우\\s*:?", 2)[, 2]
data$배우 <- str_trim(str_replace(배우부분, "\\)", ""))
# 결과 확인
head(data)

# 1. NA 값이 포함된 행 제거
data <- na.omit(data)

# 2. '항목' 열 삭제
data$항목 <- NULL  # 또는: data <- subset(data, select = -항목)

# 3. 같은 경로로 덮어쓰기 저장
write.csv(data, "C:/Users/hun-0/Desktop/캡스톤디자인/철종_조선_정보.csv", row.names = FALSE, fileEncoding = "utf-8")
```
