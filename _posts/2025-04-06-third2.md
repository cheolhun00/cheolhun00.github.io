---
layout: single
title:  "위키피디아 데이터 크롤링"
---
# 조선시대와 관련된 역사 드라마 정보 위키피디아에서 추출하기
 - rvest 활용
 - HTML 구조 활용
 - 출연한 배우 정보 추출

```r
library(rvest)
library(httr)
library(stringr)
library(dplyr)

# 1. 조선 역사 드라마 분류 페이지
category_url <- "https://ko.wikipedia.org/wiki/분류:조선_역사_드라마"
page <- read_html(GET(category_url, user_agent("Mozilla/5.0")))

# 2. 드라마 링크 추출
drama_nodes <- page %>%
  html_nodes("div.mw-category a")

drama_titles <- html_text(drama_nodes)
drama_links <- html_attr(drama_nodes, "href")
drama_links <- paste0("https://ko.wikipedia.org", drama_links)

# 3. 배우 목록 저장용
drama_cast_df <- data.frame(드라마 = character(), 배우 = character(), stringsAsFactors = FALSE)

# 4. 드라마 페이지별 배우 정보 크롤링
for (i in seq_along(drama_links)) {
  title <- drama_titles[i]
  link <- drama_links[i]
  message("🎬 ", title, " 크롤링 중...")
  
  tryCatch({
    sub_page <- read_html(GET(link, user_agent("Mozilla/5.0")))
    
    # 1단계: <ul><li> 구조에서 배우 이름 추출
    ul_cast <- sub_page %>%
      html_nodes("ul li") %>%
      html_text(trim = TRUE) %>%
      .[str_detect(., " - |:|\\(|\\)|역")]  # 배우 패턴 포함 필터
    
    # 2단계: <table>에서 행(row) 단위 추출
    table_cast <- sub_page %>%
      html_nodes("table") %>%
      html_text(trim = TRUE) %>%
      str_split("\n") %>%
      unlist() %>%
      .[str_detect(., " - |:|\\(|\\)|역")]
    
    # 병합
    cast_combined <- unique(c(ul_cast, table_cast))
    
    # 저장
    if (length(cast_combined) > 0) {
      for (actor in cast_combined) {
        drama_cast_df <- rbind(drama_cast_df, data.frame(드라마 = title, 배우 = actor, stringsAsFactors = FALSE))
      }
      message("✅ ", title, " 출연진 ", length(cast_combined), "명 수집 완료")
    } else {
      message("⚠️ ", title, " 배우 정보 없음 또는 구조 미탐지")
    }
    
    Sys.sleep(0.3)
  }, error = function(e) {
    message("❌ ", title, " 에러: ", e$message)
  })
}
# 1. 저장 경로 설정
output_file <- "조선_역사_드라마_출연진.csv"

# 2. 결과 저장 (한 번만!)
write.csv(drama_cast_df, output_file, row.names = FALSE, fileEncoding = "utf-8")
cat("\n✅ 조선 역사 드라마 출연 배우 목록 저장 완료!\n")
cat("📄 저장된 파일명:", output_file, "\n")

# 3. 결과 미리보기
cat("\n🔍 데이터 미리보기 (상위 5개)\n")
print(head(drama_cast_df, 5))

# 4. 전체 요약 정보
cat("\n🎬 총 드라마 수:", length(unique(drama_cast_df$드라마)), "편\n")
cat("👥 총 배우 출현 기록 수:", nrow(drama_cast_df), "건\n")
```
