---
layout: single
title:  "ìœ„í‚¤í”¼ë””ì•„ ë°ì´í„° í¬ë¡¤ë§"
---
# ì¡°ì„ ì‹œëŒ€ì™€ ê´€ë ¨ëœ ì—­ì‚¬ ë“œë¼ë§ˆ ì •ë³´ ìœ„í‚¤í”¼ë””ì•„ì—ì„œ ì¶”ì¶œí•˜ê¸°
 - rvest í™œìš©
 - HTML êµ¬ì¡° í™œìš©
 - ì¶œì—°í•œ ë°°ìš° ì •ë³´ ì¶”ì¶œ

```r
library(rvest)
library(httr)
library(stringr)
library(dplyr)

# 1. ì¡°ì„  ì—­ì‚¬ ë“œë¼ë§ˆ ë¶„ë¥˜ í˜ì´ì§€
category_url <- "https://ko.wikipedia.org/wiki/ë¶„ë¥˜:ì¡°ì„ _ì—­ì‚¬_ë“œë¼ë§ˆ"
page <- read_html(GET(category_url, user_agent("Mozilla/5.0")))

# 2. ë“œë¼ë§ˆ ë§í¬ ì¶”ì¶œ
drama_nodes <- page %>%
  html_nodes("div.mw-category a")

drama_titles <- html_text(drama_nodes)
drama_links <- html_attr(drama_nodes, "href")
drama_links <- paste0("https://ko.wikipedia.org", drama_links)

# 3. ë°°ìš° ëª©ë¡ ì €ì¥ìš©
drama_cast_df <- data.frame(ë“œë¼ë§ˆ = character(), ë°°ìš° = character(), stringsAsFactors = FALSE)

# 4. ë“œë¼ë§ˆ í˜ì´ì§€ë³„ ë°°ìš° ì •ë³´ í¬ë¡¤ë§
for (i in seq_along(drama_links)) {
  title <- drama_titles[i]
  link <- drama_links[i]
  message("ğŸ¬ ", title, " í¬ë¡¤ë§ ì¤‘...")
  
  tryCatch({
    sub_page <- read_html(GET(link, user_agent("Mozilla/5.0")))
    
    # 1ë‹¨ê³„: <ul><li> êµ¬ì¡°ì—ì„œ ë°°ìš° ì´ë¦„ ì¶”ì¶œ
    ul_cast <- sub_page %>%
      html_nodes("ul li") %>%
      html_text(trim = TRUE) %>%
      .[str_detect(., " - |:|\\(|\\)|ì—­")]  # ë°°ìš° íŒ¨í„´ í¬í•¨ í•„í„°
    
    # 2ë‹¨ê³„: <table>ì—ì„œ í–‰(row) ë‹¨ìœ„ ì¶”ì¶œ
    table_cast <- sub_page %>%
      html_nodes("table") %>%
      html_text(trim = TRUE) %>%
      str_split("\n") %>%
      unlist() %>%
      .[str_detect(., " - |:|\\(|\\)|ì—­")]
    
    # ë³‘í•©
    cast_combined <- unique(c(ul_cast, table_cast))
    
    # ì €ì¥
    if (length(cast_combined) > 0) {
      for (actor in cast_combined) {
        drama_cast_df <- rbind(drama_cast_df, data.frame(ë“œë¼ë§ˆ = title, ë°°ìš° = actor, stringsAsFactors = FALSE))
      }
      message("âœ… ", title, " ì¶œì—°ì§„ ", length(cast_combined), "ëª… ìˆ˜ì§‘ ì™„ë£Œ")
    } else {
      message("âš ï¸ ", title, " ë°°ìš° ì •ë³´ ì—†ìŒ ë˜ëŠ” êµ¬ì¡° ë¯¸íƒì§€")
    }
    
    Sys.sleep(0.3)
  }, error = function(e) {
    message("âŒ ", title, " ì—ëŸ¬: ", e$message)
  })
}
# 1. ì €ì¥ ê²½ë¡œ ì„¤ì •
output_file <- "ì¡°ì„ _ì—­ì‚¬_ë“œë¼ë§ˆ_ì¶œì—°ì§„.csv"

# 2. ê²°ê³¼ ì €ì¥ (í•œ ë²ˆë§Œ!)
write.csv(drama_cast_df, output_file, row.names = FALSE, fileEncoding = "utf-8")
cat("\nâœ… ì¡°ì„  ì—­ì‚¬ ë“œë¼ë§ˆ ì¶œì—° ë°°ìš° ëª©ë¡ ì €ì¥ ì™„ë£Œ!\n")
cat("ğŸ“„ ì €ì¥ëœ íŒŒì¼ëª…:", output_file, "\n")

# 3. ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°
cat("\nğŸ” ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ìƒìœ„ 5ê°œ)\n")
print(head(drama_cast_df, 5))

# 4. ì „ì²´ ìš”ì•½ ì •ë³´
cat("\nğŸ¬ ì´ ë“œë¼ë§ˆ ìˆ˜:", length(unique(drama_cast_df$ë“œë¼ë§ˆ)), "í¸\n")
cat("ğŸ‘¥ ì´ ë°°ìš° ì¶œí˜„ ê¸°ë¡ ìˆ˜:", nrow(drama_cast_df), "ê±´\n")
```
